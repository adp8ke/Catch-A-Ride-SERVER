# Catch-A-Ride

- ADRIENNE
- ARPAN
- ANDREW
- JORDON
- ZANE

## Summary

This app helps consolidate the manner in which users carpool, or "Catch-A-Ride". Users can create, delete, and edit rides, join or leave a ride, and also search for a ride by only starting location, by only destination, or by both starting location and destination.

Live App Link: https://catch-a-ride.now.sh/ <br/>
Live Server Link: https://catch-a-ride-39963.herokuapp.com <br/>
Client Repo: https://github.com/thinkful-ei-emu/Catch-A-Ride-CLIENT <br/>

## API Documentation
`/api/auth/glogin`
  * POST -> Recieves an id token generated by Google, and will send it back to Google to verify it. Then, if it confirms if the token is valid, it will return the user information from google, and if the user is not already in the database, then it will add the user to the database.
  
`/api/rides`
  * GET -> Responds with all rides in database
  * POST -> Takes a response body with search terms: {starting}, {destination}, or {starting, destination} to return a list of rides based on those searching parameters
  
`/api/rides/driver`
  * GET -> Takes user_id from request user and queries database to respond with all rides that the user is the driver
  * POST -> Takes request body of {starting, destination, date, time, description, capacity} to generate a new ride with the request user as the driver. If successful, server sends notification email to user. 
  * DELETE -> Takes request body of {ride_id} and removes the ride the ride_id is associated with, if the request user matches the driver_id. If successful, server sends notification email to user and passengers of ride.
 
`/api/rides/passenger`
  * GET -> Takes user_id from request user and queries database to respond with all rides that the user is a passenger
  * POST -> Takes request body of {ride_id} and adds the request user as a passenger to the ride if all validations pass. If successful, server sends notification email to user. 
  * PATCH -> Takes request body of {ride_id} and removes the request user as a passenger from the ride if all validations pass. If successful, server sends notification email to user. 
  
`/api/rides/:ride_id`
  * GET -> Takes ride_id from request params and responds with specific ride associated with ride_id
  * PATCH -> Takes ride_id from request params, updates the ride details using request body of {starting, destination, description, date, time} if all validations pass, and responds with updated ride. If successful, server sends notification email to user and passengers associated with the ride. 

## Technology/Frameworks Used:

* HTML
* CSS (Flexbox & Media Queries)
* JavaScript
* React
* Express
* Node.js
* PostgreSQL
* Google APIs
* Google Authentication
* Nodemailer
* Zeit
* Heroku
* Git
* GitHub
* Visual Studio Code
* Postman

## Installation:

### [Catch-A-Ride Server]()
* Install dependencies: `npm install`

* If using user `dunder-mifflin`:

```bash
mv example.env .env
createdb -U dunder-mifflin catch-a-ride
createdb -U dunder-mifflin catch-a-ride-test
```

* If your `dunder-mifflin` user has a password be sure to set it in `.env` for all appropriate fields. Or if using a different user, update appropriately.


```bash
npm install
npm run migrate
env MIGRATION_DB_NAME=spaced-repetition-test npm run migrate
```

* For testing, use client to login using the credentials below. Take the token from the application tab in dev tools, and then in the .env file, paste/set it equal to TEST_ID_TOKEN. Run npm test and all tests should pass.
    - Email: bobsmith3175@gmail.com
    - Password: Plane24235!

## Database Maintenance:
* For local database maintenance, you can use psql ... -f .\src\db-maintenance\delete_old_rides.sql to delete rides in the local database that are older than the time at invocation, but not within an interval of 24 hours.
* For heroku deployed database maintenance, you can use heroku pg:psql -f .\src\db-maintenance\delete_old_rides.sql to delete rides in the deployed database that are older than the time at invocation, but not within an interval of 24 hours.

## Configuring Postgres

* For tests involving time to run properly, configure your Postgres database to run in the UTC timezone.

1. Locate the `postgresql.conf` file for your Postgres installation.
   1. E.g. for an OS X, Homebrew install: `/usr/local/var/postgres/postgresql.conf`
   
   2. E.g. on Windows, _maybe_: `C:\Program Files\PostgreSQL\11.2\data\postgresql.conf`
   
   3. E.g  on Ubuntu 18.04 probably: '/etc/postgresql/10/main/postgresql.conf'
   
2. Find the `timezone` line and set it to `UTC`:

* Start server with `npm start` or `npm run dev`
